<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<title>login</title>
<script type="text/javascript">
var c=0,d=0;
</script>
<script>

 function  imgclick() {
	document.getElementById("img1").src="verifyimg?"+Math.random();
	
} 
 function  initajax() {
	 var xmlhttp;
	 if(window.XMLHttpRequest)
		{
		 	xmlhttp=new XMLHttpRequest();
		 	
		}
	 else
		 {
		 	xmlhttp=new ActiveObject("Microsoft.XMLHTTP")
		 }
	 return xmlhttp;
}
 function checkname()
 {
		var http_request=initajax();
		var name=document.getElementById("loginname").value;
		var id=document.getElementById("id").value;
		http_request.open("get","namecheck?loginname="+name+"&id="+id,true)
		
		http_request.onreadystatechange=function()
		{
			//alert(http_request.readyState);
			if(http_request.readyState==4)
				{
					if(http_request.status==200)
						{
						//alert(http_request.responseText);
							if(http_request.responseText=="true")
								{
								//document.getElementById("tip").innerHTML="";
								c=1;
								

					
								}
							else
								{
								alert("用户名错误");
								//document.getElementById("tip").innerHTML="用户名或id错误";
								c=0;
								

							
								}
							
							
						}
				}
		}
		http_request.send(null);

 }
 function checkverify()
 {
		var http_request=initajax();
		var verify=document.getElementById("verify").value;
		http_request.open("get","verifycheck?verify="+verify,true)
		
		http_request.onreadystatechange=function()
		{
			
			if(http_request.readyState==4)
				{
					if(http_request.status==200)
						{
 						//alert(http_request.responseText);

 						if(http_request.responseText=="true")
								{
	 
								

								//document.getElementById("tip").innerHTML="";
								d=1;
								//alert("d="+d)

								
								}
							else
								{
								alert("验证码错误");
								//document.getElementById("tip").innerHTML="验证码错误";
								d=0;

								
								}
							
							
						}
				}
		}
		http_request.send(null);

		
 }
 
 function judge()
 {
 	var names=document.getElementById("loginname").value;
 	var verify=document.getElementById("verify").value;
 	var id=document.getElementById("id").value;

 	if(names==""||names==null)
 		{
 		document.getElementById("tip1").innerHTML="用户名不能为空";
 		return false;
 		}
 	if(verify==""||verify==null)
 		{
 		document.getElementById("tip3").innerHTML="验证码不能为空";
 		return false;
 		}
 	if(id==""||id==null)
 		{
 			document.getElementById("tip2").innerHTML="id不能为空";
 			return false;
 		}
 	checkverify();
 	checkname();
 	if(c==1&&d==1)
 		{
 		return true;
 		
 		}
 	else{
 		//alert("c="+c+"d="+d);
 		return false;
 	}
 	
 	
 	

 	
 } 
</script>
<style type="text/css">
body{
 
 	background-image:url('imgs/background2.gif');
 	background-size:cover;
 	background-repeat:no-repeat;
 	color:white;
 }
 h1{

 text-align:center;

 }
 
 table{
 top:0px;
 left:0px;
 right:0px;
 bottom:0px;
 margin:auto;
 text-align:center;
 
 }
</style>
</head>
<body >
<br/>
<br/>
<br/>
<br/>
<h1 >欢迎来到企业聊天室</h1>
<form action="usenamelogin" onsubmit="return judge()">
<br/>
<table>
<tr>
<td>请输入用户名:</td>
<td><input type="text" id="loginname" name="loginname" /></td>
<td><div id="tip1" style="color:red"> </div></td>
</tr>
<tr>
<td>请输入id:</td>
<td><input type="text" id="id" name="id" /></td>
<td><div id="tip2" style="color:red"> </div></td>
</tr>
<tr>
<td>请输入验证码:</td>
<td><input type="text" name="verify" id="verify"/></td>
<td><div id="tip3" style="color:red"> </div></td>
</tr>
<tr>
<td><input type="submit" onclick="return judge()" value="打开bug世界" id="submitlgname" name="submitlgname"/></td>
<td><img id="img1" name="img1" onclick="imgclick()" src="verifyimg"></td>
</tr>
<tr>
<td><div id="tip" style="color:red"> </div></td>
</tr>
</table>

</form>
</body>
</html>